---
title: "密码学"
date: 2021-10-31T23:16:05+08:00
draft: true
toc: true
images:
tags: 
  - distributed
---

**并非所有的加密算法的安全性都可以在数学上得到证明，密码学安全是通过算法以来的数学问题来进行保密的，不是通过对算法实现的过程来进行保密的。**

## 对称加密

Symmetric Encryption ，对称加密是一种混淆算法，**明文加密和密文解密使用的密钥是一样的**。

对称加密**加密速度快，保密强度高**，适用对**大量数据进行加密场景**，**密钥的传输、管理需要保证安全**。但是大量节点使用对称加密，大规模通信的网络中，会增加节点管理密钥的负担。

代表算法 **DES、AES、SM4**

Q 这个需要在通信过程中携带密钥传输吗？？？

DH

ECC

## ECDH

Elliptic Curve Diffie-Hellman key Exchange，基于椭圆曲线的迪菲-赫尔曼密钥交换协议。

## 非对称加密

使用公私钥对，加密解密使用不同的密钥，加密的公钥可以公开，解密的密钥不能公开。

非对称加密的**加解密速度慢于对称加密，不适合大量数据加解密场景**，**性能相对较差**。**接受者无法判断发送者身份(如果公钥泄漏）**。

代表算法 RSA（Ron Rivest、Adi Shamir、Leonard Adleman）、ECC、SM2

## 混合加密

**同时使用对称加密和非对称加密**，对称加密的问题在与密钥的传输，一半都是带外传输(如果加密通信是在网络中进行，密钥的传输需要通过其他途径保证传输安全性)。

**混合加密首先通过非对称加密交换对称加密需要的密钥，后续的通信中双方使用交换的密钥对消息进行加解密。**

Q:混合加密几次非对称加密最好?

### 基于session key 的混合加密

之前对接第三方的就用过混合加密，在一个功能接口中，在会话里面发起第一个请求先使用非对称加密获取 session key ，接着在发起一个请求获取数据，使用第一个接口解密的session_key 来解密第二次请求返回的数据。

这个主要也是业务要求，接口特殊，需要先鉴权在请求数据，就是加快了第二次的加解密速度。

## 哈希算法

**Fingerprint** 指纹/ **Digest** 摘要算法，**可以将任意长度的二进制明文映射位较短的（通常是固定的二进制串/hash值)，不同的二进制明文很难映射为相同的二进制串**

**消息摘要**是指**采用单向Hash函数将需要计算摘要的数据提取后生成一串固定长度的密文，也就是数字指纹**。

消息摘要相当于是一个幂等的函数操作，同样的明文产生一致的密文，由于摘要定长，就会出现碰撞，不通的明文得到一样的密文，这个就需要hash函数具备很好的抗碰撞性，能够让现有的计算资源下，没有碰撞的现象。

**消息摘要能够很明显的反应铭文的细微变化**

- 输入长度任意，输出长度固定
- 计算简单
- 不能出现不同的输入，同样的输出
- 常见 MD5、SHA、SHA256、SHA512、SM3
- 短网址这种场景就要避免出现碰撞，如果出现碰撞现象可以丢弃，重新生成

**消息摘要不是一种加密算法**，通常保存密码，利用单向幂等性，可以使用密码明文生成进行比对，为了提高一些弱密码的安全性，通常会通过**加盐(salt)**的方式来计算哈希值，将密码加上一段随机字符(salt)在计算哈希值，把hash值和盐分开保存来提高安全性。

## 数字签名

**签名代表的事实**

- 不可伪造
- 可信
- 不可再用的
- 不可改变的
- 不可否认的

**签名的伪造、篡改。。。一系列的威胁很难避免，将签名者的身份信息绑定到代表文档的整个二进制数据上，这种不可撤销的操作就是数字签名/公钥数字签名（Digital Signature）。**

一套数字签名通常会定义两种互补的运算，一种用于签名，另一种用于验证。一般私钥用来签名，签名后的消息表示签名者对改消息的内容负责，公钥用来验证签名的正确性。

数字签名使用了消息摘要和非对称加密技术，可以保证接受者能够核实发送者对消息的签名，发送者事后不能抵赖对消息的签名，接受者不能篡改消息内容或伪造对消息的签名。

- 发送者对消息生成摘要
- 发送者用私钥对消息摘要进行加密，形成签名
- 发送者将数字签名附带在消息最后发送出去
- 接受者用公钥对签名解密，得到消息摘要
- 接受者以相同的散列函数对接收到的消息进行散列得到一个消息摘要
- 接受者比较两个消息摘要，完全一致说明没有被篡改

## 隐私保护

传统的签名可以确认用户身份，区块链的应用场景中，存在身份匿名、内容隐藏等特殊的隐私保护需求。

通过**群签名、环签名或盲签名等特殊的数字签名技术实现身份的隐私保护**。

签名者希望只需要自证其在一定的合法用户范围内，不希望存在监管角色能够反推出签名者的身份。

### 多重签名

Multi Signature，通常用于多个参与者对某消息、文件和资产同时拥有签名权或支付权的场景，根据签名的顺序不同，多重签名可以分为顺序签名和广播多重签名。

若数字资产需要经过多重签名确认才能转移，则会极大的提高资产的安全性。恶意攻击者需要获得至少一个私钥才能盗用，降低了用户无意间泄漏私钥带来的风险。

### 群签名

1991年Chaum 和 Heyst 首次提出群签名（Group Signature）的概念，**某个群组内的一个成员可以代表群组进行匿名签名，签名可以证明来自于该群组，无法确定来自于群组中的哪一个成员**。群签名方案的关键是群管理员，群管理员负责添加群成员，并且**在发生争议时揭示签名者身份**，有一些群签名方案设计方案中，添加群成员和撤销匿名性的责任被分开，分别赋予群管理员和撤销管理员。

### 环签名

Ring Signature，2001年由三位密码学家提出。

**签名者会先选定一个临时的签名者集合，集合中包括签名者自身。然后签名利用自己的私钥和集合中其他人的公钥就可以独立的产生签名，无须其他设置。**

签名者集合中的其他成员，可能并不知道自己已经被包含在最终的签名者集合中。并不能确定使用的是哪一个用户的私钥。

相对于群签名，环签名无法撤销匿名性，任何用户组都能组成一个群。

### 盲签名

Blind Signature，1982年由 David Charm 提出。

**签名者在无法看到原始内容的前提下对消息进行签名，一方面盲签名可以实现对所签内容的保护，防止签名者看到原始的内容。另外可以防止追踪，签名者无法将内容和签名结果进行对应。**

### 门限签名

1994年提出，**私钥被多个成员共享，只有指定数目的成员共同协作，才能完成密码操作。**

**门限签名一般用于随机预言机，防止审查，共识网络中防拜占庭和分布式伪随机数生成器。**

- **门限密钥生成**

  依赖分布式密钥产生协议（Distributed Key Generation，DKG)，该协议将多个参与者联合起来，生成符合一定要求的总密钥对和密钥对份额。每一个参与者对应一个密钥对份额，单个参与者只能知道部分密钥，无法获知总私钥。

- **门限密钥签名**

  参与某次签名的参与者将自己的私钥作为隐私输入，需要签名的信息作为公共输入，以此来进行一次多方的联合签名运算，最后得到签名。

  **安全多方计算的隐私性保证了参与者并不能获得其他参与者的私钥信息，但都可以得到签名。**

  **进行签名验证时，可以直接进行验证而无须与其他参与者交互，签名的验证者甚至都无法感知到验证的签名时通过门限签名的方式生成的。**

采用门限签名的方式可以实现权利分配，避免滥用职权。

**多重签名需要使用不同的私钥多次签名，私钥独立，验证通过脚本或合约判断每个签名是否可以通过验证，需要多次签证。**

**门限签名每个私钥总是私钥的一部分，多个私钥的多次签名在链下完成，最终生成一个总的签名，验证的时候只需要在链上验证一次即可。**

## Shell 隐藏操作痕迹

## 可信通信

Secure Sockets Layer ,SSL 协议最初由 Netscape 公司开发，1999年发布了SSL的拓展版本 Transport Layer Security，TLS 。

主要就是在握手的过程中协商参数、完成身份认证，使用混合加密的方式建立安全信道，最后使用对称加密的方式确保安全，加密的方式、协议版本都是可选并且协商的。

参考RFC5246

## 双向认证

客户端单向认证服务端是TLS常用的场景，服务端可以要求验证客户端，常见在银行转账汇款 U盾。

U盾中包含银行签发的证书用来验证客户端，在单项认证的第二部服务端要求客户端发送证书来验证合法性。

## 身份认证、中间人

Authentication，通过一定的手段对用户的身份进行确认。

- 基于共享密钥的身份验证
- 基于生物学特征的身份验证
- 基于公开密钥加密算法的身份验证

## 数字证书

数字证书主要用来保证信息保密、身份确认、不可否认性和数据完整性，常见的格式是X.509格式。鉴别数字证书的真伪，只需要用CA的公钥对数字证书上的签名进行验证即可。

### 数字证书结构

X.509 格式使用 ASN.1（Abstract Syntax Notation One） 抽象语法标记来表示，ASN.1 描述了一种对数据进行表示、编码、传输和解码的数据格式，用于实现平台之间的互操作性。

- 版本 Version **X.509 普遍使用 V3**
- 序列号 Serial Number **CA为每个颁发的数字证书分配一个证书，作为数字证书的唯一标识**
- 签名算法 Signature Algorithm 
- 颁发者 Issuer
- 有效期 Validity **起止日期**
- 主体名 Subject Name 如果与颁发者相同，说明数字证书是一个自签名证书
- 公钥信息 Subject Public Key Info **对外公开的公钥及所使用的公钥生成算法**
- 拓展信息 Extensions **包含证书的用法、证书吊销列表（Certificate recocation List，CRL）的发布地址等可选字段**
- 签名 Signature  **颁发者的私钥进行加密，Hash 后的摘要**

感觉和网卡差不多。

### 数字证书类型

- 自签名证书

  根证书，证书的颁发者和主体同名，证书中的公钥和用于验证证书的密钥是相同的

- 中介证书

- 服务器证书

- 终端实体证书

- 授权证书

### 数字证书编码

常见的编码格式为   PKCS#12、DER、PEM，数字证书可以相互转换。**RFC1421**

PKCS 标准是由 RSA Security 设计和发布的一组共钥加密标准，并不是真正的行业标准，常见的标准为PKCS#12，文件后缀是P12。

DER (可分辨编码规则)是一种用于存储X.509证书文件的流行编码标准，ASN.1 的可分辨编码规则是根据X.509规范对BER编码的约束得出的国际标准。DER 编码是有效的BER编码，DER编码和BER编码相似，只是删除了一个发送者的选项。

X.509证书文件最常见的编码方案是PEM（隐私增强邮件）编码，使用Base64 编码对内容进行编码，编码后的文件后缀通常为PEM，将Base64编码输出括在两行之间

```
----- BEGIN CERTIFICATE -----
----- END CERTIFICATE -----
```

DER编码的X.509证书文件是二进制文件，几乎所有应用程序都支持DER编码的证书文件，拓展名为 **.cer、.der、.crt**

## PKI

## 证书

## TEE

## openssl
